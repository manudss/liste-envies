<div class="container-fluid">
    <div class="row">
        <div class="col-lg-12">
            <h1 class="page-header">
                <form class="form-inline" ng-if="vm.editTitle">
                    <div class="form-group">
                        <input type="text" class="form-control title-edit" ng-model="vm.listEnvies.title" placeholder="@">
                    </div>
                    <button type="submit" class="btn btn-success" ng-click="vm.saveListEnvies(vm.listEnvies);"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span><span class="sr-only">Ajouter</span></button>
                </form>
                <span class="title" ng-if="!vm.editTitle">
                    {{vm.listEnvies.title}}
                    <button type="button" class="btn btn-default" tooltip="Partager votre liste" ng-if="vm.listEnvies.owner" ng-click="vm.editTitle = true">
                        <span class="glyphicon glyphicon-edit" aria-hidden="true"></span><span class="sr-only">Partager</span>
                    </button>
                    <small> de <span class="owners" ng-repeat="owner in vm.listEnvies.owners"> <i class="fa fa-user" ></i> {{owner.name}} ({{owner.email}})<span ng-if="!$last" >, </span> </span></small>
                </span>
                <button type="button" class="btn btn-default pull-right" data-toggle="modal" data-target="#share-list" tooltip="Partager votre liste" ng-if="vm.listEnvies.owner">
                    <span class="glyphicon glyphicon-user" aria-hidden="true"></span><span class="sr-only">Partager</span>
                </button>
            </h1>
        </div>
    </div>
    <div class="modal fade" tabindex="-1" role="dialog" id="share-list">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">Partager votre liste</h4>
                </div>
                <div class="modal-body">
                    <ul class="list-group">
                        <li class="list-group-item" ng-repeat="user in vm.listEnvies.users" ng-class="{active:user.type == 'OWNER'}">
                            <span class="glyphicon glyphicon-user" aria-hidden="true"></span>{{user.email}}
                            <button type="button" class="btn btn-xs btn-warning pull-right" ng-click="vm.removeUser(user);" aria-label="Partager votre liste" ng-if="user.email != main.user.email">
                                <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                            </button>
                        </li>
                    </ul>
                    <form class="form-inline">
                        <div class="form-group">
                            <label for="new-email">Email</label>
                            <input type="email" class="form-control" id="new-email" ng-model="vm.newUser.email" placeholder="@">
                        </div>
                        <div class="form-group">
                            <div class="checkbox">
                                <label>
                                    <input type="checkbox" value="" ng-true-value="'OWNER'" ng-false-value="'SHARED'" ng-model="vm.newUser.type">
                                    Co-Bénéficiaire
                                </label>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-default" ng-click="vm.shareUser(vm.newUser);"><span class="glyphicon glyphicon-share" aria-hidden="true"></span> Ajouter</button>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Fermer</button>
                    <button type="submit" class="btn btn-primary" ng-click="vm.saveListEnvies(vm.listEnvies)">Enregistrer</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal --><!--row row-fluid-->
    <p ng-bind-html="vm.listEnvies.description" ng-if="!vm.listEnvies.owner"></p>
    <summernote airMode ng-model="vm.listEnvies.description" ng-if="vm.listEnvies.owner" config="vm.editorOptions" ng-change="vm.saveListEnvies(vm.listEnvies);" ng-model-options="{ updateOn: 'default', debounce: 5000 }" lang="fr-FR"></summernote>

    <div class="order-filter row row-fluid well well-sm">
        <div class="filter col-xs-12 col-md-4">
            <div class="form-group">
                <label class="control-label">Filtrer</label><br/>
                <div class="btn-group" data-toggle="buttons">

                <!-- for shared -->
               <!-- <button ng-if="!vm.listEnvies.owner" type="button" class="btn" ng-class="filter.class" ng-click="vm.filterList(filter.expression);" ng-repeat="filter in vm.filterProperties">
                    {{filter.label}}
                </button>

                &lt;!&ndash; for owners &ndash;&gt;
                <button ng-if="vm.listEnvies.owner" type="button" class="btn" ng-class="filter.class" ng-click="vm.filterList(filter.expression);" ng-repeat="filter in vm.filterPropertiesOwners">
                    {{filter.label}}
                </button>-->

                    <!--ng-if="(!vm.listEnvies.owner && filter.owner) || (vm.listEnvies.owner && filter.shared)"-->
                <div ng-if="(vm.listEnvies.owner && filter.owner) || (!vm.listEnvies.owner && filter.shared)"
                        class="btn-group"  type="button" class="btn"  ng-repeat="filter in vm.filterProperties">
                    <button type="button" class="btn {{filter.class}}"  ng-class="{'dropdown-toggle' : filter.child}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" ng-click="vm.filterList(filter.expression);" >
                        {{filter.label}}
                    </button>
                    <button type="button"  ng-if="filter.child" class="btn {{filter.class}} dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <span class="caret"></span>
                        <span class="sr-only">Toggle Dropdown</span>
                    </button>
                    <ul class="dropdown-menu" ng-if="filter.child">
                        <li ng-repeat="children in filter.child" role="{{children.role}}" class="{{children.class}}">
                            <a ng-if="children.role == 'filter'" ng-click="vm.filterChild(children)">{{children.label}}</a>
                        </li>
                    </ul>
                </div>


            </div>
            </div>
        </div>
        <div class="search col-xs-12 col-md-4">
            <div class="row ">
                <div class="col-xs-11">
                    <div class="form-group label-floating has-feedback">
                        <label class="control-label" for="searchEnvieFilter">Rechercher</label>
                        <input type="text" class="form-control" id="searchEnvieFilter" ng-change="vm.searchList();" ng-model="vm.search">
                        <span class="fa fa-search form-control-feedback" aria-hidden="true"></span>
                    </div>
                </div>
                <div class="col-xs-1">
                    <div class="btn btn-white btn-just-icon reset-search-icon" ng-click="vm.searchList(true);">
                        <span class="fa fa-close " aria-hidden="true"></span>
                    </div>
                </div>
            </div>


        </div>
        <div class="order  col-xs-12 col-md-4">

                <div class="form-group">
                    <label class="control-label">Trier</label><br/>
                    <div class="btn-group order-btn " data-toggle="buttons">
                        <!-- Shared -->
                        <button ng-if="!vm.listEnvies.owner" type="button" class="btn btn-link" ng-class="{dropup:order.reverse}" ng-click="vm.sortList(order);" ng-repeat="order in vm.orderProperties">
                            {{order.label}}
                            <span ng-class="{caret:vm.selectedItems == order}"></span>
                        </button>

                        <!-- Owners -->
                        <button ng-if="vm.listEnvies.owner" type="button" class="btn btn-link" ng-class="{dropup:order.reverse}" ng-click="vm.sortList(order);" ng-repeat="order in vm.orderPropertiesOwners">
                            {{order.label}}
                            <span ng-class="{caret:vm.selectedItems == order}"></span>
                        </button>

                        <button class="btn btn-default pull-right" type="button" ng-click="vm.refresh();"><i class="fa fa-refresh" ></i></button>
                    </div>
                </div>
        </div>
    </div>

    <div class="row list-envie" masonry='{ "transitionDuration" : "0.4s" , "itemSelector" : ".envie-card", "percentPosition": "true" }'>
        <div class="loading" ng-if="vm.loading">
            <div class='loader'>
                <div class='loader--dot'></div>
                <div class='loader--dot'></div>
                <div class='loader--dot'></div>
                <div class='loader--dot'></div>
                <div class='loader--dot'></div>
                <div class='loader--dot'></div>
                <div class='loader--text'></div>
            </div>
        </div>
        <wish-card id="envie{{envie.id}}" masonry-tile
                   class="envie-card col-xs-12 col-sm-6 col-md-4 col-lg-4"
                   ng-repeat="envie in vm.envies | filter:vm.filter | filter:vm.search | orderBy:vm.order:vm.reverse"
                   wish="envie"
                   owner-list="vm.listEnvies.owner"
                   user="main.user"
                   parent-controller="vm"
                   list-name = "vm.name"

        >

        </wish-card>

        <wish-card masonry-tile
                   wish="vm.newWish"
                   owner-list="vm.listEnvies.owner"
                   user="main.user"
                   parent-controller="vm"
                   list-name = "vm.name"
                   class="envie-card envie-card col-xs-12 col-sm-6 col-md-4 col-lg-4" >

        </wish-card>
    </div>

</div>